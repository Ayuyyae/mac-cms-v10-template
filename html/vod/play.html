<!DOCTYPE html>
<html lang="{$maccms.site_lang|default='zh-CN'}">
<head>
    <meta charset="utf-8">
    <title>{$obj.vod_name}在线播放 - {$maccms.site_name}</title>
    <meta name="keywords" content="{$obj.vod_name}在线观看" />
    <meta name="description" content="{$obj.vod_name}剧情:{$obj.vod_blurb}" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <meta name="format-detection" content="telephone=no">
    <meta name="robots" content="noindex,nofollow">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; frame-src 'self' http://union.maccms.la https://vip.dytt-tvb.com https://union.dplayerstatic.com; img-src 'self' data: https:;">
    {include file="public/include"}
    {include file="public/head"}
    <style>
        /* Browser hijacking protection */
        html, body, * {
            -webkit-user-modify: read-only !important;
        }
        
        /* Hide video elements from browser detection */
        video, iframe[src*="player"], [class*="video"], [id*="video"] {
            pointer-events: auto !important;
            visibility: visible !important;
            display: block !important;
        }
        
        /* Prevent browser from detecting video content */
        meta[property="og:type"] { display: none !important; }
        meta[name*="video"] { display: none !important; }
        
        /* Advanced anti-hijacking protection - non-UI affecting */
        
        /* Protect video container from browser interference - minimal approach */
        .video-player, .video-container, [class*="player"] {
            isolation: isolate !important;
        }
        

        
        /* Hide from browser video detection patterns */
        iframe, embed, object {
            opacity: 0.99 !important; /* Slight transparency to avoid detection */
        }
        
        /* Prevent browser UI injection */
        body::before, body::after, html::before, html::after {
            content: none !important;
            display: none !important;
        }
        
        /* Block common browser extension selectors */
        [class*="browser"], [class*="extension"], [class*="addon"], 
        [id*="browser"], [id*="extension"], [id*="addon"] {
            display: none !important;
            visibility: hidden !important;
        }
        
        
        /* Meta tag protection */
        meta[name="referrer"] {
            content: "no-referrer" !important;
        }
    </style>
</head>
<body class="play-page-body">
    <main class="layoutMain" role="main">
        <div class="responsive">
            <div class="responsive-left">
                <!-- Sidebar content for future use -->
            </div>
            
            <div class="responsive-center">
                <div class="parent-category">
                    <!-- Video Player Section -->
                    <section class="video-section" aria-labelledby="video-title">
                        <div class="video-container">
                            {if empty($obj.vod_copyright) || $GLOBALS['config']['app']['copyright_status'] == 0}
                                <div class="video-player" role="region" aria-label="视频播放器">
                                    {$player_data} {$player_js}
                                </div>
                            {else}
                                <div class="copyright-restriction-message" role="alert" aria-live="polite">
                                    <p>{$GLOBALS['config']['app']['copyright_notice']}</p>
                                </div>
                            {/if}
                        </div>
                        
                        <!-- Navigation Controls -->
                        <nav class="back-link-container" aria-label="剧集导航">
                            <!-- Navigation controls removed - 详情 button moved to content details -->
                        </nav>
                    </section>
                    
                    <!-- Content Details Section -->
                    <section class="content-details" aria-labelledby="content-title">
                        <header>
                            <h1 id="content-title" class="detail-title">{$obj.vod_name}</h1>
                            <div class="detail-info" role="contentinfo">
                                <span class="detail-info-content">{$obj.vod_remarks}</span>
                                <span class="split-line" aria-hidden="true"></span>
                                <span class="detail-info-label">播放：</span>
                                <span class="detail-info-content">{$obj['vod_play_list'][$param['sid']]['urls'][$param['nid']]['name']}</span>
                                <span class="split-line" aria-hidden="true"></span>
                                <a href="{:mac_url_vod_detail($obj)}" class="back-link detail-link" draggable="false" aria-label="查看详情页">
                                    详情
                                </a>
                            </div>
                        </header>
                        
                        <!-- Episode List Section -->
                        <section class="episode-section" aria-labelledby="episode-title">
                            <header class="episode-header">
                                <h2 id="episode-title" class="detail-section-title">
                                    播放列表
                                </h2>
                                <button type="button" class="more-link episode-sort-btn" onclick="toggleOrderAndFlip(); return false;" aria-label="切换剧集排序">
                                    切换顺序
                                    <svg id="orderIcon" xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 512 421.65" width="20" height="20" class="more-link-icon" aria-hidden="true">
                                        <path fill="currentColor" fill-rule="nonzero" d="M383.01 379.71c11.57 0 20.97 9.4 20.97 20.97 0 11.57-9.4 20.97-20.97 20.97l-362.04-.44C9.4 421.21 0 411.81 0 400.24c0-11.57 9.4-20.97 20.97-20.97l362.04.44zm-90.97-238.93c-7.91 7.94-20.8 7.99-28.74.08-7.94-7.91-7.99-20.8-.08-28.74L369.33 5.98c7.91-7.94 20.79-7.99 28.73-.08l107.98 107.91c7.95 7.94 7.95 20.87 0 28.81-7.94 7.95-20.87 7.95-28.81 0l-73.12-73.11.32 206.4c0 11.2-9.1 20.3-20.3 20.3-11.2 0-20.29-9.1-20.29-20.3l-.32-206.63-71.48 71.5zM171.62 40.59c11.57 0 20.97 9.41 20.97 20.98 0 11.56-9.4 20.97-20.97 20.97l-150.65-.16C9.4 82.38 0 72.97 0 61.4c0-11.56 9.4-20.97 20.97-20.97l150.65.16zm41.33 170.71c11.57 0 20.97 9.4 20.97 20.97 0 11.57-9.4 20.97-20.97 20.97l-191.98-.23C9.4 253.01 0 243.61 0 232.04c0-11.56 9.4-20.97 20.97-20.97l191.98.23z"/>
                                    </svg>
                                </button>
                            </header>
                            
                            <div class="episode-list" id="episodeList" role="list" aria-label="剧集列表">
                                {maccms:foreach name="obj.vod_play_list" id="vo" key="key"}
                                {maccms:foreach name="vo.urls" id="vo2" key="key2" }
                                <div class="episode {if condition="$obj.player_info.sid eq $vo.sid && $obj.player_info.nid eq $vo2.nid"}currentplay{/if}" role="listitem">
                                    <a href="{:mac_url_vod_play($obj,['sid'=>$vo.sid,'nid'=>$vo2.nid])}" draggable="false" 
                                       {if condition="$obj.player_info.sid eq $vo.sid && $obj.player_info.nid eq $vo2.nid"}aria-current="page"{/if}
                                       title="播放第{$vo2.name}集">
                                        {$vo2.name}
                                    </a>
                                </div>
                                {/maccms:foreach}
                                {/maccms:foreach}
                            </div>
                        </section>
                    </section>
                    
                    <!-- Comments Section -->
                    <section class="comments-section" aria-labelledby="comments-title">
                        <header>
                            <h2 id="comments-title" class="section-title">评论功能</h2>
                            <span class="coming-soon-badge" aria-label="即将推出">Coming Soon</span>
                        </header>
                        
                        <div class="comments-preview" aria-label="评论预览">
                            <article class="comment" role="article">
                                <header class="comment-header">
                                    <span class="comment-author">用户1</span>
                                    <time class="comment-date" datetime="2024-07-22T10:30">2024-07-22 10:30</time>
                                </header>
                                <div class="comment-content">
                                    这是一条评论内容。
                                </div>
                            </article>
                            
                            <article class="comment" role="article">
                                <header class="comment-header">
                                    <span class="comment-author">用户2</span>
                                    <time class="comment-date" datetime="2024-07-22T11:15">2024-07-22 11:15</time>
                                </header>
                                <div class="comment-content">
                                    这是另一条评论内容。
                                </div>
                            </article>
                        </div>
                    </section>
                </div>
            </div>
            
            <div class="responsive-right">
                <!-- Sidebar content for future use -->
            </div>
        </div>
    </main>
    
    {include file="public/foot"}
    
    <!-- Anti-hijacking and URL obfuscation -->
    <script src="{$maccms.path_tpl}js/url-obfuscator.js"></script>
    
    <!-- JavaScript -->
    <script src="{$maccms.path_tpl}js/modern-sorting.js"></script>
    <script src="{$maccms.path_tpl}js/modern-player.js"></script>
    
    <script>
    // Aggressive video sizing fix for MacCMS player content
    function fixVideoSize() {
        // Target the video-player div where MacCMS injects content
        const videoPlayer = document.querySelector('.video-player');
        if (videoPlayer) {
            // Force the video-player container itself
            videoPlayer.style.width = '100%';
            videoPlayer.style.height = '100%';
            videoPlayer.style.position = 'absolute';
            videoPlayer.style.top = '0';
            videoPlayer.style.left = '0';
            
            // Target all possible elements inside video-player
            const allElements = videoPlayer.querySelectorAll('*');
            allElements.forEach(element => {
                // Force dimensions on all elements
                element.style.width = '100%';
                element.style.height = '100%';
                
                // Remove aspect ratio constraints
                element.style.paddingBottom = '0';
                element.style.paddingTop = '0';
                element.style.aspectRatio = 'unset';
                
                // Force video elements specifically
                if (['IFRAME', 'VIDEO', 'EMBED', 'OBJECT'].includes(element.tagName)) {
                    element.style.position = 'absolute';
                    element.style.top = '0';
                    element.style.left = '0';
                    element.style.objectFit = 'cover';
                }
            });
        }
    }
    
    // Run immediately and frequently to catch MacCMS dynamic content
    fixVideoSize();
    document.addEventListener('DOMContentLoaded', fixVideoSize);
    window.addEventListener('load', fixVideoSize);
    
    // Run more frequently to catch MacCMS player loading
    setInterval(fixVideoSize, 500);
    
    // Also watch for DOM changes
    const observer = new MutationObserver(fixVideoSize);
    observer.observe(document.body, { childList: true, subtree: true });
    </script>
</body>
</html>